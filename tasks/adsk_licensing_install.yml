---

- name: Install licensing dependencies
  become: true
  when: adsk_licensing_dependency not in ansible_facts.packages
  loop: "{{ adsk_licensing_dependencies }}"
  loop_control:
    loop_var: adsk_licensing_dependency
  ansible.builtin.package:
    name: "{{ adsk_licensing_dependency }}"

- name: Find license manager RPMs
  loop: "{{ license_manager_packages }}"
  ansible.builtin.find:
    paths: "{{ license_manager_package_dir }}/{{ license_manager_package_sub_dir }}"
    patterns: "{{ item }}*.rpm"
  register: found_rpms

# - name: Show file matches
#   loop: "{{ found_rpms.results }}"
#   loop_control:
#     label: "{{ item.item }}"
#   ansible.builtin.debug:
#     msg: "{{ item.files | map(attribute='path') | first | basename | splitext | first }}"

- name: Install license manager packages
  become: true
  loop: "{{ found_rpms.results }}"
  loop_control:
    label: "{{ item.item }}"
  ansible.builtin.dnf:
    name: "{{ item.files | map(attribute='path') | first }}"
    state: "present"
    disable_gpg_check: true

- name: Remove installer packages
  become: true
  ansible.builtin.file:
    path: "{{ installer.target_directory }}/{{ license_manager_package_sub_dir }}"
    state: "absent"

...
